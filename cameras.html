<body>
<div class="content">
<title>Minewatch</title>
<link rel="stylesheet" href="style.css">
<div class="navbar">
<img src="imgs/logo.png" height="36px" width="36px" class="logo">
<h1 class="logo-title">MineWatch</h1>
<div class="vertical-line"></div>
<a href="minewatch.html" class="space-right">Home</a>
<a href="cameras.html" class="space-right">Cameras</a>
<a href="guide.html" class="space-right">Guide</a>
<div class="right-links">
<a href="guestbook.html" class="space-right">Guestbook</a>
<a href="addcamera.html" class="space-right">Add a camera</a>
</div>
</div>
<div class="banner">
<p>Streaming real Minecraft Java Edition players (1.0.0–1.15) with Allow Snooper enabled.</p>
</div>
<div style="height: 40px;"></div>
<div class="infobox">
<h1>Cameras</h1>
<div class="horizontal-line"></div>
<p>Watch live streams from real Minecraft Java Edition players, or recorded videos after they leave.</p>
<br>
<label>Sort by:</label>
<select class="select1">
<option value="pplr">Most popular</option>
<option value="new">Newest</option>
<option value="old">Oldest</option>
<option value="rndm">Random</option>
</select>
<br>
<br>
<p class="normalCenter">Alternatively...</p>
<a class="textCenterLink" href="" id="random-link">Random camera</a>
<script src="https://unpkg.com/video.js@8.6.0/dist/video.min.js" onerror="window.videojsFailed=true"></script>
<script src="https://vjs.zencdn.net/8.6.0/video.min.js" onerror="window.videojsFailed=true"></script>
<script src="/js/video.min.js" onerror="window.videojsFailed=true"></script>
<link href="https://unpkg.com/video.js@8.6.0/dist/video-js.min.css" rel="stylesheet">
<p class="normalCenter"></p>
</div>
<br>
<div class="oCams">
<div class="camSpot">
<video id="video-1111" class="video-js vjs-default-skin" controls preload="auto" width="320" height="240" poster="cameras/preview/1111.png">
<source src="http://minewatch-reborn.onrender.com/stream/cameraid1111.m3u8" type="application/x-mpegURL">
</video>
<p>ID: 1111 | Username: <span id="username-1111">Unknown</span> | Mode: <span id="mode-1111">Unknown</span> | Version: <span id="version-1111">Unknown</span> | Action: <span id="action-1111">Unknown</span></p>
<p><input id="chat-1111" type="text" placeholder="Chat with player..." onkeypress="if(event.key==='Enter')sendChat('1111',this.value)"></p>
</div>
<div class="camSpot">
<video id="video-1221" class="video-js vjs-default-skin" controls preload="auto" width="320" height="240" poster="cameras/preview/1221.png">
<source src="http://minewatch-reborn.onrender.com/stream/cameraid1221.m3u8" type="application/x-mpegURL">
</video>
<p>ID: 1221 | Username: <span id="username-1221">Unknown</span> | Mode: <span id="mode-1221">Unknown</span> | Version: <span id="version-1221">Unknown</span> | Action: <span id="action-1221">Unknown</span></p>
<p><input id="chat-1221" type="text" placeholder="Chat with player..." onkeypress="if(event.key==='Enter')sendChat('1221',this.value)"></p>
</div>
<div class="camSpot">
<video id="video-2121" class="video-js vjs-default-skin" controls preload="auto" width="320" height="240" poster="cameras/preview/2121.png">
<source src="http://minewatch-reborn.onrender.com/stream/cameraid2121.m3u8" type="application/x-mpegURL">
</video>
<p>ID: 2121 | Username: <span id="username-2121">Unknown</span> | Mode: <span id="mode-2121">Unknown</span> | Version: <span id="version-2121">Unknown</span> | Action: <span id="action-2121">Unknown</span></p>
<p><input id="chat-2121" type="text" placeholder="Chat with player..." onkeypress="if(event.key==='Enter')sendChat('2121',this.value)"></p>
</div>
</div>
<div class="oCams">
<div class="camSpot">
<video id="video-2425" class="video-js vjs-default-skin" controls preload="auto" width="320" height="240" poster="cameras/preview/2425.png">
<source src="http://minewatch-reborn.onrender.com/stream/cameraid2425.m3u8" type="application/x-mpegURL">
</video>
<p>ID: 2425 | Username: <span id="username-2425">Unknown</span> | Mode: <span id="mode-2425">Unknown</span> | Version: <span id="version-2425">Unknown</span> | Action: <span id="action-2425">Unknown</span></p>
<p><input id="chat-2425" type="text" placeholder="Chat with player..." onkeypress="if(event.key==='Enter')sendChat('2425',this.value)"></p>
</div>
<div class="camSpot">
<video id="video-2633" class="video-js vjs-default-skin" controls preload="auto" width="320" height="240" poster="cameras/preview/2633.png">
<source src="http://minewatch-reborn.onrender.com/stream/cameraid2633.m3u8" type="application/x-mpegURL">
</video>
<p>ID: 2633 | Username: <span id="username-2633">Unknown</span> | Mode: <span id="mode-2633">Unknown</span> | Version: <span id="version-2633">Unknown</span> | Action: <span id="action-2633">Unknown</span></p>
<p><input id="chat-2633" type="text" placeholder="Chat with player..." onkeypress="if(event.key==='Enter')sendChat('2633',this.value)"></p>
</div>
<div class="camSpot">
<video id="video-2342" class="video-js vjs-default-skin" controls preload="auto" width="320" height="240" poster="cameras/preview/2342.png">
<source src="http://minewatch-reborn.onrender.com/stream/cameraid2342.m3u8" type="application/x-mpegURL">
</video>
<p>ID: 2342 | Username: <span id="username-2342">Unknown</span> | Mode: <span id="mode-2342">Unknown</span> | Version: <span id="version-2342">Unknown</span> | Action: <span id="action-2342">Unknown</span></p>
<p><input id="chat-2342" type="text" placeholder="Chat with player..." onkeypress="if(event.key==='Enter')sendChat('2342',this.value)"></p>
</div>
</div>
<div class="oCams">
<div class="camSpot">
<video id="video-2233" class="video-js vjs-default-skin" controls preload="auto" width="320" height="240" poster="cameras/preview/2233.png">
<source src="http://minewatch-reborn.onrender.com/stream/cameraid2233.m3u8" type="application/x-mpegURL">
</video>
<p>ID: 2233 | Username: <span id="username-2233">Unknown</span> | Mode: <span id="mode-2233">Unknown</span> | Version: <span id="version-2233">Unknown</span> | Action: <span id="action-2233">Unknown</span></p>
<p><input id="chat-2233" type="text" placeholder="Chat with player..." onkeypress="if(event.key==='Enter')sendChat('2233',this.value)"></p>
</div>
<div class="camSpot">
<video id="video-3001" class="video-js vjs-default-skin" controls preload="auto" width="320" height="240" poster="cameras/preview/3001.png">
<source src="http://minewatch-reborn.onrender.com/stream/cameraid3001.m3u8" type="application/x-mpegURL">
</video>
<p>ID: 3001 | Username: <span id="username-3001">Unknown</span> | Mode: <span id="mode-3001">Unknown</span> | Version: <span id="version-3001">Unknown</span> | Action: <span id="action-3001">Unknown</span></p>
<p><input id="chat-3001" type="text" placeholder="Chat with player..." onkeypress="if(event.key==='Enter')sendChat('3001',this.value)"></p>
</div>
<div class="camSpot">
<video id="video-1211" class="video-js vjs-default-skin" controls preload="auto" width="320" height="240" poster="cameras/preview/1211.png">
<source src="http://minewatch-reborn.onrender.com/stream/cameraid1211.m3u8" type="application/x-mpegURL">
</video>
<p>ID: 1211 | Username: <span id="username-1211">Unknown</span> | Mode: <span id="mode-1211">Unknown</span> | Version: <span id="version-1211">Unknown</span> | Action: <span id="action-1211">Unknown</span></p>
<p><input id="chat-1211" type="text" placeholder="Chat with player..." onkeypress="if(event.key==='Enter')sendChat('1211',this.value)"></p>
</div>
</div>
<br>
<center>
<button> < </button>
<label> Page 1 </label>
<button> > </button>
</center>
<title>Minewatch</title>
<link rel="stylesheet" href="style.css">
<footer style="margin-top: 40px;">
<div class="horizontal-line"></div>
<center>
<p>Minewatch © 2024</p>
<p>We are not responsible for any kind of usage. <a href="#" id="back-to-top">Back to top</a></p>
</center>
</footer>
<script>
const SERVER_URL = 'ws://minewatch-reborn.onrender.com:8080';
const HLS_BASE_URL = 'http://minewatch-reborn.onrender.com';
const cameraIds = ['1111', '1221', '2121', '2425', '2633', '2342', '2233', '3001', '1211'];

document.querySelector('#back-to-top')?.addEventListener('click', (e) => {
  e.preventDefault();
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

function formatTimestampForFilename() {
  const now = new Date();
  return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}-${String(now.getSeconds()).padStart(2, '0')}`;
}

function initializePlayer(videoElement, cameraId, isLive, filename, retryCount = 0) {
  const maxRetries = 3;
  if (window.videojsFailed || typeof videojs === 'undefined') {
    videoElement.style.display = 'none';
    const img = document.createElement('img');
    img.src = `cameras/preview/${cameraId}.png`;
    img.width = 320;
    img.height = 240;
    img.alt = 'Video failed to load';
    videoElement.parentNode.insertBefore(img, videoElement);
    return;
  }
  try {
    const source = isLive 
      ? { src: `${HLS_BASE_URL}/stream/cameraid${cameraId}.m3u8`, type: 'application/x-mpegURL' }
      : { src: `${HLS_BASE_URL}/videos/${filename}`, type: 'video/mp4' };
    const player = videojs(videoElement, {
      autoplay: false,
      controls: true,
      errorDisplay: false,
      sources: [source]
    }, function() {
      this.on('error', () => {
        this.dispose();
        videoElement.style.display = 'none';
        const img = document.createElement('img');
        img.src = `cameras/preview/${cameraId}.png`;
        img.width = 320;
        img.height = 240;
        img.alt = 'Stream unavailable';
        videoElement.parentNode.insertBefore(img, videoElement);
        if (retryCount < maxRetries && isLive) {
          setTimeout(() => initializePlayer(videoElement, cameraId, isLive, filename, retryCount + 1), 5000);
        }
      });
    });
  } catch (e) {}
}

function startRecording(cameraId, username, mode, version, action) {
  try {
    const records = JSON.parse(localStorage.getItem('cameraRecords') || '[]');
    if (records.find(r => r.cameraId === cameraId && r.status === 'recording')) return;
    const startTimestamp = new Date().toISOString();
    const filename = `${formatTimestampForFilename()}.mp4`;
    const previewImage = `cameras/preview/${cameraId}.png`;
    records.push({ cameraId, username, mode, version, action, startTimestamp, filename, previewImage, status: 'recording' });
    localStorage.setItem('cameraRecords', JSON.stringify(records));
    const videoElement = document.getElementById(`video-${cameraId}`);
    const usernameElement = document.getElementById(`username-${cameraId}`);
    const modeElement = document.getElementById(`mode-${cameraId}`);
    const versionElement = document.getElementById(`version-${cameraId}`);
    const actionElement = document.getElementById(`action-${cameraId}`);
    if (videoElement) {
      videoElement.style.display = 'block';
      videoElement.parentNode.querySelector('img')?.remove();
      initializePlayer(videoElement, cameraId, true, filename);
    }
    if (usernameElement) usernameElement.textContent = username || 'Unknown';
    if (modeElement) modeElement.textContent = mode || 'Unknown';
    if (versionElement) versionElement.textContent = version || 'Unknown';
    if (actionElement) actionElement.textContent = action || 'Idle';
  } catch (e) {}
}

function stopRecording(cameraId) {
  try {
    const records = JSON.parse(localStorage.getItem('cameraRecords') || '[]');
    const record = records.find(r => r.cameraId === cameraId && r.status === 'recording');
    if (!record) return;
    record.stopTimestamp = new Date().toISOString();
    record.status = 'stopped';
    localStorage.setItem('cameraRecords', JSON.stringify(records));
    const videoElement = document.getElementById(`video-${cameraId}`);
    if (videoElement) {
      const player = videojs.getPlayer(videoElement);
      if (player) player.dispose();
      videoElement.style.display = 'block';
      videoElement.parentNode.querySelector('img')?.remove();
      initializePlayer(videoElement, cameraId, false, record.filename);
    }
  } catch (e) {}
}

function sendChat(cameraId, message) {
  try {
    const input = document.getElementById(`chat-${cameraId}`);
    if (message && input) {
      const ws = new WebSocket(SERVER_URL);
      ws.onopen = () => {
        ws.send(JSON.stringify({ cameraId, text: message }));
        ws.close();
      };
      input.value = '';
    }
  } catch (e) {}
}

function checkVideojsLoaded(callback) {
  if (typeof videojs !== 'undefined' && !window.videojsFailed) {
    callback();
  } else {
    setTimeout(() => checkVideojsLoaded(callback), 100);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const randomLink = document.getElementById('random-link');
  const sortSelect = document.querySelector('.select1');
  if (randomLink) {
    randomLink.addEventListener('click', (e) => {
      e.preventDefault();
      const randomId = cameraIds[Math.floor(Math.random() * cameraIds.length)];
      window.location.href = `cameraid${randomId}.html`;
    });
  }
  if (sortSelect) {
    sortSelect.addEventListener('change', () => {});
  }

  let ws;
  try {
    ws = new WebSocket(SERVER_URL);
    ws.onmessage = (event) => {
      try {
        const { event: evt, cameraId, username, mode, version, action } = JSON.parse(event.data);
        if (evt === 'waiting' && cameraIds.includes(cameraId)) {
          const records = JSON.parse(localStorage.getItem('cameraRecords') || '[]');
          const record = records.find(r => r.cameraId === cameraId && r.status === 'recording');
          if (!record) {
            const videoElement = document.getElementById(`video-${cameraId}`);
            if (videoElement) {
              videoElement.style.display = 'none';
              const img = document.createElement('img');
              img.src = `cameras/preview/${cameraId}.png`;
              img.width = 320;
              img.height = 240;
              img.alt = 'Waiting for player';
              videoElement.parentNode.insertBefore(img, videoElement);
            }
            const usernameElement = document.getElementById(`username-${cameraId}`);
            const modeElement = document.getElementById(`mode-${cameraId}`);
            const versionElement = document.getElementById(`version-${cameraId}`);
            const actionElement = document.getElementById(`action-${cameraId}`);
            if (usernameElement) usernameElement.textContent = username || 'Unknown';
            if (modeElement) modeElement.textContent = mode || 'Unknown';
            if (versionElement) versionElement.textContent = version || 'Unknown';
            if (actionElement) actionElement.textContent = 'Waiting';
          }
        } else if (evt === 'join' && cameraIds.includes(cameraId)) {
          startRecording(cameraId, username, mode, version, action);
        } else if (evt === 'leave' && cameraIds.includes(cameraId)) {
          stopRecording(cameraId);
        } else if (evt === 'action' && cameraIds.includes(cameraId)) {
          const actionElement = document.getElementById(`action-${cameraId}`);
          if (actionElement) actionElement.textContent = action || 'Idle';
          const records = JSON.parse(localStorage.getItem('cameraRecords') || '[]');
          const record = records.find(r => r.cameraId === cameraId && r.status === 'recording');
          if (record) {
            record.action = action;
            localStorage.setItem('cameraRecords', JSON.stringify(records));
          }
        }
      } catch (e) {}
    };
    ws.onerror = () => {};
    ws.onclose = () => {
      setTimeout(() => {
        ws = new WebSocket(SERVER_URL);
      }, 5000);
    };
  } catch (e) {}

  checkVideojsLoaded(() => {
    document.querySelectorAll('.video-js').forEach(video => {
      try {
        const cameraId = video.id.replace('video-', '');
        const records = JSON.parse(localStorage.getItem('cameraRecords') || '[]');
        const record = records.find(r => r.cameraId === cameraId && r.status === 'recording');
        if (!record) {
          const stoppedRecord = records.find(r => r.cameraId === cameraId && r.status === 'stopped');
          video.style.display = stoppedRecord ? 'block' : 'none';
          if (!stoppedRecord) {
            const img = document.createElement('img');
            img.src = `cameras/preview/${cameraId}.png`;
            img.width = 320;
            img.height = 240;
            img.alt = 'No active recording';
            video.parentNode.insertBefore(img, video);
          } else {
            initializePlayer(video, cameraId, false, stoppedRecord.filename);
          }
        } else {
          video.style.display = 'block';
          const usernameElement = document.getElementById(`username-${cameraId}`);
          const modeElement = document.getElementById(`mode-${cameraId}`);
          const versionElement = document.getElementById(`version-${cameraId}`);
          const actionElement = document.getElementById(`action-${cameraId}`);
          if (usernameElement) usernameElement.textContent = record.username || 'Unknown';
          if (modeElement) modeElement.textContent = record.mode || 'Unknown';
          if (versionElement) versionElement.textContent = record.version || 'Unknown';
          if (actionElement) actionElement.textContent = record.action || 'Idle';
          initializePlayer(video, cameraId, true, record.filename);
        }
      } catch (e) {}
    });
  });
});
</script>
</div>
</body>